Hereâ€™s a concise, developer-friendly **README.md** you can drop right next to your generator script (`lcm_gen.py`):

---

# ğŸ§© Lightweight LCM â†’ Python Generator

A minimal, **pure-Python re-implementation** of `lcm-gen` that converts `.lcm` message definitions into **Python classes** â€” without requiring the full LCM toolchain or any non-stdlib dependencies.

This version faithfully matches the layout and encode/decode semantics of standard LCM-generated Python code, including:

* `__slots__`, `__typenames__`, and `__dimensions__`
* `_encode_one()` and `_decode_one()` functions using `struct.pack()` and `BytesIO`
* LCM fingerprints and `_get_hash_recursive()`
* Nested message imports (`from eigen.types.generated.foo import foo`)
* Optional flat-directory generation via `--no-package-dirs`
* Automatic `__init__.py` with `__all__` for clean imports

---

## ğŸš€ Quick Start

### 1ï¸âƒ£  Create your `.lcm` definition(s)

Example: `definitions/aexample_t.lcm`

```lcm
package eigen.types.generated;

struct aexample_t {
    int64_t    timestamp;
    double     position[3];
    double     orientation[4];
    int32_t    num_ranges;
    int16_t    ranges[num_ranges];
    string     name;
    boolean    enabled;
}
```

### 2ï¸âƒ£  Run the generator

```bash
python3 lcm_gen.py \
    --py-out src/eigen/types/generated \
    definitions/*.lcm
```

This will:

* Parse all `.lcm` files under `definitions/`
* Create subfolders for packages (e.g. `eigen/types/generated/`)
* Generate Python classes such as `aexample_t.py`
* Generate an `__init__.py` that imports and exposes all message types

### 3ï¸âƒ£  (Optional) Flat output

If your package folders (e.g. `eigen/types/generated/`) already exist and you **donâ€™t** want the generator to recreate subfolders, run:

```bash
python3 lcm_gen.py \
    --py-out src/eigen/types/generated \
    --no-package-dirs \
    definitions/*.lcm
```

The generated files will still import with the **package path from the `.lcm` file**,
but will all be written directly into the `--py-out` directory.

---

## ğŸ“¦  Example Generated File

`src/eigen/types/generated/aexample_t.py`:

```python
"""LCM type definitions
This file automatically generated by lcm.
DO NOT MODIFY BY HAND!!!!
"""

from io import BytesIO
import struct

class aexample_t(object):
    __slots__ = ["timestamp", "position", "orientation", "num_ranges", "ranges", "name", "enabled"]
    __typenames__ = ["int64_t", "double", "double", "int32_t", "int16_t", "string", "boolean"]
    __dimensions__ = [None, [3], [4], None, ["num_ranges"], None, None]

    def __init__(self):
        self.timestamp = 0
        self.position = [0.0 for dim0 in range(3)]
        self.orientation = [0.0 for dim0 in range(4)]
        self.num_ranges = 0
        self.ranges = []
        self.name = ""
        self.enabled = False

    def encode(self):
        buf = BytesIO()
        buf.write(aexample_t._get_packed_fingerprint())
        self._encode_one(buf)
        return buf.getvalue()

    def _encode_one(self, buf):
        buf.write(struct.pack(">q", self.timestamp))
        buf.write(struct.pack(">3d", *self.position[:3]))
        buf.write(struct.pack(">4d", *self.orientation[:4]))
        buf.write(struct.pack(">i", self.num_ranges))
        buf.write(struct.pack(">%dh" % self.num_ranges, *self.ranges[:self.num_ranges]))
        __name_encoded = self.name.encode('utf-8')
        buf.write(struct.pack(">I", len(__name_encoded)+1))
        buf.write(__name_encoded)
        buf.write(b"\0")
        buf.write(struct.pack(">b", self.enabled))
```

---

## ğŸ§   Notes

* Compatible with **Python 3.8+**
* Generates pure-Python code, no `lcm` dependency required
* Works with any `.lcm` struct, including nested message types
* Automatically generates `__init__.py` with:

  ```python
  from .aexample_t import aexample_t

  __all__ = [
      'aexample_t',
  ]
  ```
* Matches the binary encoding of official `lcm-gen --python`

---

## ğŸ§°  CLI Reference

| Flag                | Description                                                                   |
| ------------------- | ----------------------------------------------------------------------------- |
| `--py-out DIR`      | Output directory for generated `.py` files                                    |
| `--no-package-dirs` | Disable package subfolder creation; still use `.lcm` package path for imports |
| `src ...`           | One or more `.lcm` source files                                               |

---

## ğŸ§ª Example Integration

After generation:

```python
from eigen.types.generated.aexample_t import aexample_t

msg = aexample_t()
msg.timestamp = 123456
msg.position = [1.0, 2.0, 3.0]
msg.orientation = [0.0, 0.0, 0.0, 1.0]
msg.num_ranges = 2
msg.ranges = [42, 43]
msg.name = "sensor"
msg.enabled = True

data = msg.encode()
decoded = aexample_t.decode(data)
print(decoded.name)  # -> "sensor"
```

---

## To Generate Default Types
```bash
uv run lcm_gen.py --py-out generated/ --no-package-dirs definitions/*
```